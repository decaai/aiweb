<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gusa Ai V2.5.4</title>
  <style>
    /* Mengimpor font pixel dari Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * {
      box-sizing: border-box;
      /* Menggunakan font pixel jika tersedia, fallback ke monospace */
      font-family: 'Press Start 2P', cursive, monospace;
    }

    body {
      margin: 0;
      /* Warna dasar tanah/lumut */
      background: #507D2A;
      /* Menambahkan efek pixelated ringan pada background */
      background-image:
        linear-gradient(45deg, rgba(0, 0, 0, 0.1) 25%, transparent 25%, transparent 75%, rgba(0, 0, 0, 0.1) 75%, rgba(0, 0, 0, 0.1) 100%),
        linear-gradient(-45deg, rgba(0, 0, 0, 0.1) 25%, transparent 25%, transparent 75%, rgba(0, 0, 0, 0.1) 75%, rgba(0, 0, 0, 0.1) 100%);
      background-size: 8px 8px; /* Ukuran pixel */
      color: #F0F2EB; /* Warna teks yang kontras dengan background alam */
      text-rendering: crisp-edges; /* Mencoba membuat teks terlihat lebih pixelated */
    }

    header {
      display: flex;
      align-items: center;
      padding: 10px;
      /* Border seperti akar pohon atau cabang */
      border-bottom: 3px solid #3A571F;
      background: #6B8E23; /* Warna hijau daun tua */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Efek shadow ringan */
    }

    header img {
      width: 30px;
      margin-right: 10px;
      cursor: pointer;
      /* Membulatkan gambar agar terlihat seperti ikon game lama */
      border-radius: 5px;
      image-rendering: pixelated; /* Memastikan gambar tetap pixelated */
    }

    header h1 {
      font-size: 20px;
      font-weight: bold;
      color: #F0F2EB; /* Warna teks judul */
      text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2); /* Efek shadow teks untuk nuansa pixel */
    }

    .chat {
      padding: 20px;
      height: 70vh;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      /* Latar belakang chat seperti permukaan air atau langit */
      background: #A7D9D3;
      border-left: 3px solid #507D2A;
      border-right: 3px solid #507D2A;
      border-bottom: 3px solid #507D2A;
      /* Scrollbar ala pixel */
      scrollbar-width: thin;
      scrollbar-color: #3A571F #A7D9D3;
    }

    /* Scrollbar untuk Webkit (Chrome, Safari) */
    .chat::-webkit-scrollbar {
      width: 12px;
    }

    .chat::-webkit-scrollbar-track {
      background: #A7D9D3;
    }

    .chat::-webkit-scrollbar-thumb {
      background-color: #3A571F;
      border-radius: 20px;
      border: 3px solid #A7D9D3;
    }


    .user,
    .ai {
      margin: 10px 0;
      padding: 10px 15px;
      max-width: 70%;
      /* Border radius yang lebih kotak untuk efek pixel */
      border-radius: 4px;
      display: inline-block;
      /* Box shadow untuk efek kedalaman pixel */
      box-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
    }

    .user {
      /* Warna gelembung user seperti batu atau tanah liat */
      background: #8B4513;
      color: #F0F2EB;
      align-self: flex-end;
    }

    .ai {
      /* Warna gelembung AI seperti awan atau kabut */
      background: #D3D3D3;
      color: #3A571F;
      align-self: flex-start;
    }

    .input-container {
      display: flex;
      padding: 10px;
      /* Border atas seperti batang pohon */
      border-top: 3px solid #3A571F;
      background: #6B8E23;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);
    }

    input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      /* Border radius yang lebih kotak */
      border-radius: 4px;
      /* Border input seperti kulit pohon */
      border: 2px solid #3A571F;
      background: #F0F2EB;
      color: #3A571F;
      /* Efek inset untuk tombol yang ditekan */
      box-shadow: inset 2px 2px 0px rgba(0, 0, 0, 0.2);
    }

    input::placeholder {
      color: rgba(58, 87, 31, 0.7);
    }

    button {
      margin-left: 10px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
      color: #F0F2EB;
      text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.2);
      /* Efek hover untuk tombol */
      transition: transform 0.1s ease-in-out;
    }

    button:hover {
      transform: translateY(-2px);
    }

    button:active {
      transform: translateY(1px);
    }

    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      width: 100%;
      /* Background sidebar seperti tebing atau gua */
      background: #4A4A4A;
      z-index: 10;
      padding: 20px;
      display: none;
      flex-direction: column;
      text-align: center;
      /* Border seperti akar atau retakan */
      border-right: 3px solid #2B2B2B;
      color: #F0F2EB;
      /* Efek pixelated pada background */
      background-image:
        linear-gradient(45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%, rgba(255, 255, 255, 0.1) 100%),
        linear-gradient(-45deg, rgba(255, 255, 255, 0.1) 25%, transparent 25%, transparent 75%, rgba(255, 255, 255, 0.1) 75%, rgba(255, 255, 255, 0.1) 100%);
      background-size: 10px 10px;
    }

    .sidebar.active {
      display: flex;
    }

    .sidebar p {
      text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.2);
    }

    .sidebar button.link-btn {
      margin: 10px auto;
      padding: 10px;
      font-size: 16px;
      /* Border tombol seperti cabang kering */
      border: 2px solid #2B2B2B;
      /* Border radius yang lebih kotak */
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 200px;
      cursor: pointer;
      text-decoration: none;
      color: #F0F2EB;
      /* Background tombol seperti tanah atau lumpur */
      background: #8B4513;
      /* Efek inset untuk tombol */
      box-shadow: inset 2px 2px 0px rgba(0, 0, 0, 0.2);
      transition: background 0.1s ease-in-out, transform 0.1s ease-in-out;
    }

    .sidebar button.link-btn:hover {
      background: #A0522D; /* Warna yang sedikit lebih cerah saat hover */
      transform: translateY(-2px);
    }

    .sidebar button.link-btn:active {
      transform: translateY(1px);
      box-shadow: inset 1px 1px 0px rgba(0, 0, 0, 0.2);
    }

    .sidebar .back-btn {
      margin-top: 20px;
      padding: 8px 20px;
      /* Border tombol kembali seperti lumut */
      border: 2px solid #3A571F;
      /* Border radius yang lebih kotak */
      border-radius: 4px;
      cursor: pointer;
      color: #F0F2EB;
      /* Background tombol kembali seperti daun */
      background: #507D2A;
      /* Efek inset untuk tombol */
      box-shadow: inset 2px 2px 0px rgba(0, 0, 0, 0.2);
      transition: background 0.1s ease-in-out, transform 0.1s ease-in-out;
    }

    .sidebar .back-btn:hover {
      background: #6B8E23;
      transform: translateY(-2px);
    }

    .sidebar .back-btn:active {
      transform: translateY(1px);
      box-shadow: inset 1px 1px 0px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>
  <div class="sidebar" id="menuSidebar">
    <p><strong>Created By WISNU ELITIS</strong></p>
    <p>Information:</p>

    <a class ="back-btn" href="https://your-website.com" class="link-btn" target="_blank">🌐 Website</a>
    <a class ="back-btn" href="https://wa.me/1234567890" class="link-btn" target="_blank">📱 WhatsApp</a>
    <a class ="back-btn" href="https://instagram.com/yourusername" class="link-btn" target="_blank">📷 Instagram</a>
    <a class ="back-btn" href="tel:+621234567890" class="link-btn" target="_blank">📞 Contact Us</a>

    <p style="margin-top:auto;">Thanks To God.</p>
    <button class="back-btn" onclick="toggleSidebar()">Kembali</button>
  </div>

  <header>
    <img src="https://cdn-icons-png.flaticon.com/512/512/512222.png" onclick="toggleSidebar()" />
    <h1>Gusa Ai V2.5.4</h1>
  </header>

  <div class="chat" id="chatBox">
    </div>

  <div class="input-container">
    <input type="text" id="userInput" placeholder="masukkan teks..." />
    <button onclick="sendMessage()">➤</button>
  </div>

  <script>
    const chatBox = document.getElementById('chatBox');
    const input = document.getElementById('userInput');

    // Data rules dari AutoResponder yang Anda berikan
    // Format: "pattern","pattern_matching","reply_message","multiple_replies","multiple_reply_delay","multiple_reply_delay_max",...
    const autoResponderRules = [
      "/menu","none","Halo kak @%name%\nSelamat datang di Nandaa Botz\n\nSilahkan register terlebih dahulu ya!!\n*Example:* /register Nanda","single","","","b","","","","","0","","","","","","","","seconds","3","0","","",,,,,,,,,,",
      "/allmenu","none","Wait///<#>Halo kak %name%🫠\n\nNama: %name%\nBallance: %rndm_num_1000_10000000%\n\nNama bot: Nandaa Botz\nCreator: Nandaa\nServer: autoresponder\n\n===========================\n                     GAME MENU\n===========================\n•/gacha\n•/shop\n•/gojek\n•/ngepet\n•/maling\n•/mancing\n•/berburu\n•/apakah <pesan>\n•/kapan <pesan>\n•/cekgay @\n•/cekpintar @\n•/cektolol @\n===========================\n                   GLOBAL MENU\n===========================\n•/menu\n•/listmenu\n•/Owner\n•/botserver\n•/antilink\n•/cektanggal\n\n============================\n                    OWNER MENU\n============================\n•/addbalance\n•/addxp\n•/ban\n\n=============================\n                    OTHER MENU\n=============================\n•/afk\n•/bot <pesan>\n\n~Mohon maaf jika ada bug mohon di maklumi karena ini masih tahap Beta!\n\nRuntime: 24jam","all","5","5","b","","","","","0","","","","","","","","seconds","0","1","","",,,,,,,,,,",
      "/gacha","none","Wait////<#>Berapakali spin yang anda inginkan?\n\n[ 1x ] or [ 5x ]","all","3","3","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/shop","none","!! KETIK /SB JIKA MAU MEMBELI DAN /SC !!\n\n*Contoh: /SB durian 10*\n\nKeterangan: \n-sb (shop buy)\n-sc (shop cancel)\n\n*List shop*\n\n-ikan (3k)\n-potion heal (15k)\n-xp (2k)\n-jajan (5k)\n-minuman (5k)\n-udang (20k)\n-jagung (10k)\n-durian (50k)","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/sb*","normal","Apakah anda yakin untuk membeli barang?\n\n[ Y ] or [ N ]","single","","","b","","","2","2","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/sc","none","BERHASIL CANCEL!","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/gojek","none","Menunggu pelanggan///<#>Menemukan pelanggan///\n\nNama: %rndm_custom_1_tono,Rudy, Hartono, Ahmad, Jaiz,brody,Jokowi,Nandaa,Fathan,Lintang,asep,udin%\nTujuan: %rndm_custom_1_bali,Amerika,Papua,Jawa,Kalimantan,Sumatra,Australia,China,Thailand,Myanmar,India,Afrika,polandia%\nOngkos: %%rndm_num_1000000_1000000000000%\n\n%rndm_num_1_3% hari kemudian////\n\nPelanggan telah sampai","all","3","3","b","","","3","3","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/ngepet","none","Sorry! I don't run this command\nBut, this is not halal!","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/maling","none","Anda telah di tangkap polisi 👮‍♂️🚔<#>ANDA BERHASIL MALING!\nBarang yang di dapat:\n\nuang sebesar 1 miliar","random","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/mancing","none","Sedang memancing/////<#>Selesai mancing///<#>Hasil yang didapat:\n%rndm_custom_1_ranting kayu,ikan 10 ekor,ga dapet apa apa%","all","","","b","","","3","3","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/berburu","none","Menjelajahi hutan///<#>Sedang berburu///<#>Hasil yang di dapat:\n%rndm_custom_1_kelinci 2 ekor,ga dapet apa apa,harimau,burung elang,kucing,singa,kangguru%","all","3","3","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/apakah*","normal","Pertanyaan: %message%\nJawab: %rndm_custom_1_iya,tidak,mungkin iya,mungkin tidak%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/kapan*","normal","Pertanyaan: %message%\nJawab: %rndm_custom_1_nanti,gk tau,besok,tahun depan, bulan depan,mana gw tau🗿%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/cekgay @*","normal","Pertanyaan: %message%\nJawab: %rndm_num_0_100%%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/cekpintar @*","normal","Pertanyaan: %message%\nJawab: %rndm_num_0_100%%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,<seg_33>
      "/cektolol @*","normal","Pertanyaan: %message%\nJawab: %rndm_num_0_100%%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/listmenu","none","List menu:\n\n-/menu\n-/allmenu","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/owner","none","Pake nanya","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/botserver","none","({Bot Server})\n\n•Nama » %name%\n•NamaBot » NandaBotzV1\n•Server » autoresponder\n•Script » public","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/antilink","none","Halo!! Antilink nya udah aktif kak","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/cektanggal","none","Sekarang adalah tanggal %day_of_month%,%month_name%,%year%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "https*","normal","[{LINK DETECTOR}]\n\nDI LARANG MENYEBAR LINK GROUP SEBELUM ADA IZIN DARI ADMIN!","single","","","g","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "kontol//memek//ngentot//ngentod//asu//asw//tolol//lolok//pepek//","normal","~Anti toxic~\n\nNama: %name%\nPesan: %message%\n\nApa coba","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/ban///addxp///addbalance","normal","Maaf! Anda bukan owner","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "(\/|#|/|\$|!)(afk)(\\s*/*)","expert","Nama: %name%\nReason: %capturing_group_3%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/bot*///ai*","normal","Berikut percakapan dengan asisten AI menggunakan AutoResponder/ai/ Asistennya sangat membantu, kreatif, pintar, dan sangat ramah/\n\n1:: %prev_message_0_3_512%\n2:: %prev_reply_0_3_512%\n1:: %prev_message_0_2_512%\n2:: %prev_reply_0_2_512%\n1:: %prev_message_0_1_512%\n2:: %prev_reply_0_1_512%\n1:: %message_512%\n2: Maaf, saya tidak dapat memproses perintah AI eksternal dalam mode ini.","gpt3","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/cekgay","none","Lu mau cek siapa anjg?🗿\nMinimal tag orangnya lah","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/cekpintar","none","APAAN SIH KANG\nLU MAU CEK SIAPA COBA\n\nMINIMAL TAG ORANG NYA","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "(\/|#|/|\$|!)(register)(\\s*/*)","expert","Menunggu/////<#>Halo%capturing_group_3% \n\nKamu berhasil di register!\nSilahkan ketik /menu","all","4","4","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "(\/|#|/|\$|!)(menu)(\\s*/*)","expert","Wait ya! ⌛///<#>Halo kak%capturing_group_3% \n\n\nNama bot: Nandaa Botz\nCreator: Nandaa\nServer: autoresponder\nScript: public\nPrefix: [ / ]\nVersion: 1/0/0\nTanggal: %day_of_week%, %month%, %year%\n\n===========================\n                     GAME MENU\n===========================\n•/gacha\n•/shop\n•/gojek\n•/ngepet\n•/maling\n•/mancing\n•/berburu\n•/apakah <pesan>\n•/kapan <pesan>\n•/cekgay @\n•/cekpintar @\n•/cektolol @\n===========================\n                   GLOBAL MENU\n===========================\n•/menu\n•/listmenu\n•/Owner\n•/botserver\n•/antilink\n•/cektanggal\n•/infobot\n•/restartbot\n•/profil\n\n============================\n                    OWNER MENU\n============================\n•/addbalance\n•/addxp\n•/ban\n\n=============================\n                    OTHER MENU\n=============================\n•/afk\n•/bot <pesan>\n•/hidetag <pesan>\n•/script\n\n~Mohon maaf jika ada bug mohon di maklumi karena ini masih tahap Beta!\n\nRuntime: 24jam","all","3","3","b","","","3","3","0","","","","","","","","seconds","0","0","28","",,,,,,,,,,",
      "/infobot","none","Mohon tunggu ⌛///<#>*[{Bot Info}]*\n\nNama bot: NandaBotz\nOwner: Nanda api geratis\nPrefix: [ / ]\nServer: autoresponder\nScript: public\nBahasa: [ 🇮🇩 ]\nOnline: 24jam","all","3","3","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/restartbot","none","Menunggu ⌛/////<#>Yakin untuk restart bot?\n[ Y ]  or  [ N ]","all","5","5","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "/profil","none","{[Profil]}\n\n~Nama: %name%\n~user: Android\n~uang: Rp%rndm_num_0_1000000%\n~rank: gratisan","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "y","none","Mohon tunggu////<#>Bot telah di restart !","all","5","5","b","","","","","0","","","","","","","","seconds","0","0","31","",,,,,,,,,,",
      "n","none","Restart bot berhasil di cancel !","single","","","b","","","","","0","","","","","","","","seconds","0","0","31","",,,,,,,,,,",
      "1x","none","Mohon tunggu////<#>Selamat @%name% !!\nKamu mendapatkan %rndm_custom_1_,200xp,ikan cupang,20 bounty,10k money,zonk,tanah liat,berlian,jagung,makanan%","all","3","3","b","","","3","3","0","","","","","","","","seconds","0","0","3","",,,,,,,,,,",
      "5x","none","Mohon tunggu///<#>Selamat @%name% !!\nKamu mendapatkan %rndm_custom_1_,200xp,ikan cupang,20 bounty,10k money,zonk,tanah liat,berlian,jagung,makanan%,Selamat @%name% !!\nKamu mendapatkan %rndm_custom_1_,200xp,ikan cupang,20 bounty,10k money,zonk,tanah liat,berlian,jagung,makanan%,Selamat @%name% !!\nKamu mendapatkan %rndm_custom_1_,200xp,ikan cupang,20 bounty,10k money,zonk,tanah liat,berlian,jagung,makanan%,Selamat @%name% !!\nKamu mendapatkan %rndm_custom_1_,200xp,ikan cupang,20 bounty,10k money,zonk,tanah liat,berlian,jagung,makanan%,Selamat @%name% !!\nKamu mendapatkan %rndm_custom_1_,200xp,ikan cupang,20 bounty,10k money,zonk,tanah liat,berlian,jagung,makanan%","all","3","3","b","","","","","0","","","","","","","","seconds","0","0","3","",,,,,,,,,,",
      "/addpremium @*","normal","Apakah anda yakin ?\n[ Y ] or [ N ]","single","","","b","","","","","0","","","","","","","","seconds","0","1","","",,,,,,,,,,",
      "y","none","Mohon tunggu!/////<#>Berhasil","all","","","b","","","3","3","0","","","","","","","","seconds","0","0","37","",,,,,,,,,,",
      "(\/|#|/|\$|!)(hidetag)(\\s*/*)","expert","%capturing_group_3%","single","","","b","","","","","0","","","","","","","","seconds","0","0","","",,,,,,,,,,",
      "y","none","Maaf! UANG ANDA TIDAK CUKUP<#>Berhasil membeli barang!","random","","","b","","","","","0","","","","","","","","seconds","0","0","5","",,,,,",
      "n","none","Pembelian berhasil di cancel","single","","","b","","","","","0","","","","","","","","seconds","0","0","5","",,,,,,,,,,"
    ];

    // Fungsi untuk mendapatkan nama pengguna (bisa disesuaikan jika ada login, dll.)
    function getUserName() {
      // Untuk tujuan demo, kita bisa pakai nama statis atau minta input pertama kali
      return "Pengguna";
    }

    // Fungsi untuk menghasilkan angka acak
    function getRandomNumber(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // Fungsi untuk memproses placeholder dan logika AutoResponder
    async function processReply(replyMessage, replyType, delay, delayMax, messageText, userName, regexMatch = null) {
      let replies = [];

      // Split based on "///" (multiple replies)
      let parts = replyMessage.split('///');

      // Filter out empty parts that might result from trailing "///"
      parts = parts.filter(part => part.trim() !== '');

      // Replace placeholders for each part
      for (let i = 0; i < parts.length; i++) {
        let processedPart = parts[i];

        // Replace <#> (line break in AutoResponder) with newline character
        processedPart = processedPart.replace(/<#>/g, '\n');

        // %name%
        processedPart = processedPart.replace(/%name%/g, userName || getUserName());

        // %message% (this refers to the original user input)
        processedPart = processedPart.replace(/%message%/g, messageText);

        // %day_of_month%, %month_name%, %year%, %day_of_week%, %month%
        const date = new Date();
        processedPart = processedPart.replace(/%day_of_month%/g, date.getDate());
        processedPart = processedPart.replace(/%month_name%/g, date.toLocaleString('id-ID', { month: 'long' }));
        processedPart = processedPart.replace(/%year%/g, date.getFullYear());
        processedPart = processedPart.replace(/%day_of_week%/g, date.toLocaleString('id-ID', { weekday: 'long' }));
        processedPart = processedPart.replace(/%month%/g, date.toLocaleString('id-ID', { month: 'long' }));


        // %rndm_num_min_max%
        processedPart = processedPart.replace(/%rndm_num_(\d+)_(\d+)%/g, (match, min, max) => {
          return getRandomNumber(parseInt(min), parseInt(max));
        });

        // %rndm_custom_1_val1,val2,val3%
        processedPart = processedPart.replace(/%rndm_custom_1_([^%]+)%/g, (match, values) => {
          const customValues = values.split(',');
          return customValues[Math.floor(Math.random() * customValues.length)];
        });

        // %capturing_group_X%
        // This is where we use the regexMatch object if it exists
        processedPart = processedPart.replace(/%capturing_group_(\d+)%/g, (match, groupNum) => {
            const index = parseInt(groupNum);
            return (regexMatch && regexMatch[index]) ? regexMatch[index] : ''; // Return captured group or empty string
        });

        // Other specific placeholders not covered (like %prev_message%, etc.)
        // These are more complex and rely on chat history. For now, we'll strip them or replace with generic.
        processedPart = processedPart.replace(/%prev_message_[^%]+%/g, '[Pesan Sebelumnya]');
        processedPart = processedPart.replace(/%prev_reply_[^%]+%/g, '[Balasan Sebelumnya]');
        processedPart = processedPart.replace(/%message_(\d+)%/g, messageText); // %message_512% means truncating message to 512 chars

        replies.push(processedPart);
      }

      if (replyType === "single" || replies.length === 1) {
        appendChat('ai', replies[0]);
      } else if (replyType === "all") {
        for (let i = 0; i < replies.length; i++) {
          appendChat('ai', replies[i]);
          if (i < replies.length - 1) { // Add delay between multiple replies
            // Use multipleReplyDelay if available, else default to 0.5s.
            // Also consider multipleReplyDelayMax if it were implemented for a range.
            const currentDelay = multipleReplyDelay ? parseInt(multipleReplyDelay) * 1000 : 500;
            await new Promise(resolve => setTimeout(resolve, currentDelay));
          }
        }
      } else if (replyType === "random") {
        const randomReply = replies[Math.floor(Math.random() * replies.length)];
        appendChat('ai', randomReply);
      }
    }

    function toggleSidebar() {
      document.getElementById('menuSidebar').classList.toggle('active');
    }

    function appendChat(role, message) {
      const div = document.createElement('div');
      div.className = role;
      div.innerHTML = message.replace(/\n/g, '<br>'); // Handle newlines for display
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return; // Don't send empty messages
      appendChat('user', text);
      input.value = '';

      let foundMatch = false;
      const userName = getUserName(); // Get current user name
      const lowerCaseText = text.toLowerCase();
      
      for (const ruleString of autoResponderRules) {
        const parts = ruleString.split('","'); // Split by ","
        if (parts.length < 3) continue; // Skip malformed rules

        const pattern = parts[0];
        const patternMatching = parts[1];
        const replyMessage = parts[2];
        const multipleReplies = parts[3]; // "single", "all", "random"
        const multipleReplyDelay = parts[4] || ""; // Delay value (e.g., "3")
        const multipleReplyDelayMax = parts[5] || ""; // Max delay (e.g., "3")

        let isMatch = false;
        let regexMatch = null; // To store regex capturing groups

        if (patternMatching === "none") { // Exact match (case-insensitive)
          isMatch = (lowerCaseText === pattern.toLowerCase());
        } else if (patternMatching === "normal") { // Contains or starts with (simplified interpretation for "normal")
          if (pattern.endsWith('*')) { // Pattern like /sb*
            const basePattern = pattern.slice(0, -1).toLowerCase();
            isMatch = lowerCaseText.startsWith(basePattern);
          } else if (pattern.includes('//')) { // Multiple keywords separated by "//"
            const keywords = pattern.toLowerCase().split('//');
            isMatch = keywords.some(keyword => lowerCaseText.includes(keyword.trim()));
          } else { // Direct contains match
            isMatch = lowerCaseText.includes(pattern.toLowerCase());
          }
        } else if (patternMatching === "expert") { // Regex matching
          try {
            // Clean up the regex pattern from AutoResponder for JS
            // Common AutoResponder expert patterns like (\/|#|/|\$|!)(afk)(\s*/*) need careful conversion
            let jsPattern = pattern;
            // Escape slashes and handle common AutoResponder regex specific syntax
            jsPattern = jsPattern.replace(/\\/g, '\\\\') // Escape backslashes first
                                 .replace(/\//g, '\\/') // Escape forward slashes
                                 .replace(/\s*\/\*\s*/g, '(\\s*.*)?'); // Handle `/*` as optional any characters

            // For patterns like `(\/|#|/|\$|!)` which are already escaped slashes in your data,
            // we need to be careful not to double escape.
            // A more robust regex conversion would parse the AutoResponder regex string,
            // but for these specific patterns, we can do direct replacements.
            jsPattern = jsPattern.replace(/\\\\\//g, '\\/'); // Fix double-escaped slashes if they occurred

            const regex = new RegExp(jsPattern, 'i'); // Case-insensitive
            const match = text.match(regex);
            if (match) {
                isMatch = true;
                regexMatch = match; // Store the match object to pass capturing groups
            }
          } catch (e) {
            console.error("Invalid regex pattern:", pattern, e);
          }
        }

        if (isMatch) {
          foundMatch = true;
          // Pass the regexMatch object to processReply for %capturing_group_X%
          await processReply(replyMessage, multipleReplies, multipleReplyDelay, multipleReplyDelayMax, text, userName, regexMatch);
          break; // Stop after first match
        }
      }

      if (!foundMatch) {
        appendChat('ai', "Maaf, saya tidak mengerti perintah Anda. Coba ketik `/menu` atau `/allmenu`.");
      }
    }

    // --- Perbaikan agar tombol Enter berfungsi ---
    input.addEventListener('keypress', function(event) {
      // Periksa jika tombol yang ditekan adalah 'Enter' (keyCode 13 atau key 'Enter')
      if (event.key === 'Enter' || event.keyCode === 13) {
        event.preventDefault(); // Mencegah baris baru di input
        sendMessage(); // Panggil fungsi pengiriman pesan
      }
    });
    // --- Akhir Perbaikan ---
  </script>
</body>
</html>
